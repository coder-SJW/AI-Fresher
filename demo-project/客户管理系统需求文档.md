# 客户管理系统（CRM）后台需求文档

## 1. 项目概述

### 1.1 项目背景
客户管理系统是一个面向企业的客户关系管理平台，旨在帮助企业高效管理客户信息、跟进记录、销售机会等核心业务数据，提升客户管理效率和销售业绩。

### 1.2 项目目标
构建一个功能完善、性能优良的客户管理系统后台，支持企业对客户全生命周期的管理。

### 1.3 技术栈
- **后端框架**: Spring Boot 2.x
- **JDK 版本**: Java 8
- **ORM 框架**: MyBatis-Plus 3.x
- **数据库**: MySQL 5.7+
- **API 风格**: RESTful
- **构建工具**: Maven

---

## 2. 功能需求

### 2.1 客户管理模块

#### 2.1.1 客户信息管理
- **客户列表查询**
  - 支持分页查询
  - 支持按客户名称、联系人、手机号模糊搜索
  - 支持按客户状态、来源筛选
  - 支持按创建时间排序

- **客户详情查看**
  - 查看客户完整信息
  - 查看客户跟进记录
  - 查看客户关联的销售机会

- **新增客户**
  - 录入客户基本信息
  - 录入联系人信息
  - 设置客户来源和初始状态

- **编辑客户**
  - 修改客户基本信息
  - 修改联系人信息
  - 更新客户状态

- **删除客户**
  - 支持软删除
  - 删除前检查是否有关联数据

#### 2.1.2 客户字段设计
| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | BIGINT | 客户ID（主键） | 是 |
| customerName | VARCHAR(100) | 客户名称 | 是 |
| contactName | VARCHAR(50) | 联系人姓名 | 是 |
| contactPhone | VARCHAR(20) | 联系电话 | 是 |
| contactEmail | VARCHAR(100) | 联系邮箱 | 否 |
| companyAddress | VARCHAR(255) | 公司地址 | 否 |
| customerSource | VARCHAR(50) | 客户来源 | 否 |
| customerStatus | VARCHAR(20) | 客户状态 | 是 |
| remark | TEXT | 备注 | 否 |
| createTime | DATETIME | 创建时间 | 是 |
| updateTime | DATETIME | 更新时间 | 是 |
| isDeleted | TINYINT | 删除标记 | 是 |

### 2.2 跟进记录模块

#### 2.2.1 跟进记录管理
- **跟进记录列表**
  - 按客户ID查询该客户的跟进记录
  - 支持分页
  - 按跟进时间倒序排列

- **新增跟进记录**
  - 关联客户ID
  - 记录跟进内容
  - 记录跟进方式（电话/微信/邮件/上门）
  - 记录下次跟进时间

- **编辑跟进记录**
  - 修改跟进内容

- **删除跟进记录**

#### 2.2.2 跟进记录字段设计
| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | BIGINT | 记录ID（主键） | 是 |
| customerId | BIGINT | 客户ID（外键） | 是 |
| followUpContent | TEXT | 跟进内容 | 是 |
| followUpMethod | VARCHAR(20) | 跟进方式 | 是 |
| nextFollowUpTime | DATETIME | 下次跟进时间 | 否 |
| followUpPerson | VARCHAR(50) | 跟进人 | 是 |
| createTime | DATETIME | 创建时间 | 是 |
| updateTime | DATETIME | 更新时间 | 是 |
| isDeleted | TINYINT | 删除标记 | 是 |

### 2.3 销售机会模块

#### 2.3.1 销售机会管理
- **销售机会列表**
  - 分页查询
  - 按客户筛选
  - 按阶段筛选
  - 按预计成交日期筛选

- **新增销售机会**
  - 关联客户
  - 设置机会名称
  - 设置预计成交金额
  - 设置预计成交日期
  - 设置销售阶段

- **编辑销售机会**
  - 更新机会信息
  - 推进销售阶段

- **删除销售机会**

#### 2.3.2 销售机会字段设计
| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | BIGINT | 机会ID（主键） | 是 |
| customerId | BIGINT | 客户ID（外键） | 是 |
| opportunityName | VARCHAR(200) | 机会名称 | 是 |
| estimatedAmount | DECIMAL(12,2) | 预计金额 | 是 |
| estimatedCloseDate | DATE | 预计成交日期 | 是 |
| salesStage | VARCHAR(50) | 销售阶段 | 是 |
| probability | INT | 成交概率(%) | 否 |
| remark | TEXT | 备注 | 否 |
| createTime | DATETIME | 创建时间 | 是 |
| updateTime | DATETIME | 更新时间 | 是 |
| isDeleted | TINYINT | 删除标记 | 是 |

### 2.4 用户管理模块

#### 2.4.1 用户管理
- **用户列表**
  - 分页查询
  - 按用户名、姓名搜索
  - 按状态筛选

- **新增用户**
  - 创建用户账号
  - 分配角色

- **编辑用户**
  - 修改用户信息
  - 重置密码

- **删除用户**
  - 软删除

#### 2.4.2 用户字段设计
| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | BIGINT | 用户ID（主键） | 是 |
| username | VARCHAR(50) | 用户名（唯一） | 是 |
| password | VARCHAR(100) | 密码（加密） | 是 |
| realName | VARCHAR(50) | 真实姓名 | 是 |
| phone | VARCHAR(20) | 手机号 | 否 |
| email | VARCHAR(100) | 邮箱 | 否 |
| status | TINYINT | 状态（1启用0禁用） | 是 |
| roleId | BIGINT | 角色ID | 是 |
| createTime | DATETIME | 创建时间 | 是 |
| updateTime | DATETIME | 更新时间 | 是 |
| isDeleted | TINYINT | 删除标记 | 是 |

### 2.5 系统基础模块

#### 2.5.1 数据字典
- 客户来源管理
- 客户状态管理
- 跟进方式管理
- 销售阶段管理

#### 2.5.2 数据字典字段设计
| 字段名 | 类型 | 说明 | 必填 |
|--------|------|------|------|
| id | BIGINT | 字典ID（主键） | 是 |
| dictType | VARCHAR(50) | 字典类型 | 是 |
| dictLabel | VARCHAR(100) | 字典标签 | 是 |
| dictValue | VARCHAR(100) | 字典值 | 是 |
| sortOrder | INT | 排序 | 否 |
| status | TINYINT | 状态 | 是 |
| createTime | DATETIME | 创建时间 | 是 |
| updateTime | DATETIME | 更新时间 | 是 |
| isDeleted | TINYINT | 删除标记 | 是 |

---

## 3. API 接口设计（RESTful）

### 3.1 客户管理接口

| HTTP 方法 | URL路径 | 说明 |
|-----------|---------|------|
| GET | /api/customers | 分页查询客户列表 |
| GET | /api/customers/{id} | 获取客户详情 |
| POST | /api/customers | 新增客户 |
| PUT | /api/customers/{id} | 编辑客户 |
| DELETE | /api/customers/{id} | 删除客户 |

**查询参数示例：**
```
GET /api/customers?page=1&size=10&customerName=张&customerStatus=潜在客户
```

### 3.2 跟进记录接口

| HTTP 方法 | URL路径 | 说明 |
|-----------|---------|------|
| GET | /api/follow-ups?customerId={id} | 查询客户的跟进记录 |
| GET | /api/follow-ups/{id} | 获取跟进记录详情 |
| POST | /api/follow-ups | 新增跟进记录 |
| PUT | /api/follow-ups/{id} | 编辑跟进记录 |
| DELETE | /api/follow-ups/{id} | 删除跟进记录 |

### 3.3 销售机会接口

| HTTP 方法 | URL路径 | 说明 |
|-----------|---------|------|
| GET | /api/opportunities | 分页查询销售机会 |
| GET | /api/opportunities/{id} | 获取销售机会详情 |
| POST | /api/opportunities | 新增销售机会 |
| PUT | /api/opportunities/{id} | 编辑销售机会 |
| DELETE | /api/opportunities/{id} | 删除销售机会 |

### 3.4 用户管理接口

| HTTP 方法 | URL路径 | 说明 |
|-----------|---------|------|
| GET | /api/users | 分页查询用户列表 |
| GET | /api/users/{id} | 获取用户详情 |
| POST | /api/users | 新增用户 |
| PUT | /api/users/{id} | 编辑用户 |
| DELETE | /api/users/{id} | 删除用户 |
| POST | /api/users/{id}/reset-password | 重置密码 |

### 3.5 数据字典接口

| HTTP 方法 | URL路径 | 说明 |
|-----------|---------|------|
| GET | /api/dict/{type} | 根据类型获取字典列表 |
| GET | /api/dict/{type}/{value} | 获取字典详情 |
| POST | /api/dict | 新增字典 |
| PUT | /api/dict/{id} | 编辑字典 |
| DELETE | /api/dict/{id} | 删除字典 |

---

## 4. 统一响应格式

### 4.1 成功响应
```json
{
  "code": 200,
  "message": "操作成功",
  "data": { }
}
```

### 4.2 分页响应
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "records": [],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
  }
}
```

### 4.3 失败响应
```json
{
  "code": 500,
  "message": "系统错误",
  "data": null
}
```

### 4.4 响应状态码规范
- **200**: 成功
- **201**: 创建成功
- **400**: 请求参数错误
- **401**: 未授权
- **403**: 禁止访问
- **404**: 资源不存在
- **500**: 服务器内部错误

---

## 5. 数据库设计

### 5.1 表命名规范
- 表名使用小写字母
- 多单词用下划线分隔
- 统一添加前缀 `crm_`

### 5.2 核心表列表
| 表名 | 说明 |
|------|------|
| crm_customer | 客户表 |
| crm_follow_up | 跟进记录表 |
| crm_opportunity | 销售机会表 |
| crm_user | 用户表 |
| crm_role | 角色表 |
| crm_dict | 数据字典表 |
| crm_dict_data | 字典数据表 |

---

## 6. 非功能性需求

### 6.1 性能要求
- API 响应时间 < 500ms（P95）
- 支持 100+ 并发用户
- 数据库查询优化，避免全表扫描

### 6.2 安全要求
- 密码使用 BCrypt 加密存储
- 接口需要 Token 认证（JWT）
- 敏感操作需要权限验证
- SQL 注入防护

### 6.3 日志要求
- 记录关键业务操作日志
- 记录异常堆栈信息
- 日志级别：ERROR、WARN、INFO、DEBUG

### 6.4 代码规范
- 遵循阿里巴巴 Java 开发手册
- 使用 Lombok 简化代码
- 统一异常处理
- 统一日志记录

---

## 7. 技术实现要点

### 7.1 分层架构
```
Controller 层（接口层）
    ↓
Service 层（业务逻辑层）
    ↓
Mapper 层（数据访问层）
```

### 7.2 核心依赖
```xml
<!-- Spring Boot -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- MyBatis-Plus -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3</version>
</dependency>

<!-- MySQL驱动 -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
</dependency>

<!-- Lombok -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
</dependency>

<!-- JWT -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.9.1</version>
</dependency>
```

### 7.3 MyBatis-Plus 配置要点
- 使用 `@TableName` 映射表名
- 使用 `@TableId` 配置主键策略（雪花算法）
- 使用 `@TableLogic` 实现逻辑删除
- 使用 `@TableField` 处理特殊字段

### 7.4 RESTful 最佳实践
- 使用 HTTP 动词表达操作类型
- 使用名词表示资源
- URL 层级不超过 3 层
- 使用复数形式（/customers 而非 /customer）

---

## 8. 开发优先级

### Phase 1: 基础框架搭建
1. 创建 Spring Boot 项目
2. 配置数据库连接
3. 配置 MyBatis-Plus
4. 创建统一响应和异常处理
5. 搭建基础代码结构

### Phase 2: 用户模块
1. 用户表设计与创建
2. 用户 CRUD 接口
3. JWT 登录认证
4. 权限拦截器

### Phase 3: 客户模块
1. 客户表设计与创建
2. 客户 CRUD 接口
3. 客户查询与筛选

### Phase 4: 跟进记录模块
1. 跟进记录表设计与创建
2. 跟进记录 CRUD 接口
3. 客户-跟进记录关联查询

### Phase 5: 销售机会模块
1. 销售机会表设计与创建
2. 销售机会 CRUD 接口
3. 销售-机会关联查询

### Phase 6: 数据字典模块
1. 字典表设计与创建
2. 字典 CRUD 接口
3. 字典缓存

---

## 9. 验收标准

### 9.1 功能验收
- ✓ 所有接口按 RESTful 规范实现
- ✓ 支持 CRUD 基本操作
- ✓ 分页查询功能正常
- ✓ 数据校验完善
- ✓ 异常处理合理

### 9.2 代码质量
- ✓ 代码注释清晰
- ✓ 命名规范统一
- ✓ 无明显代码冗余
- ✓ 通过基本测试

---

## 附录

### A. 客户状态枚举
- 潜在客户
- 意向客户
- 成交客户
- 流失客户

### B. 客户来源枚举
- 线上推广
- 线下活动
- 客户转介绍
- 主动咨询
- 其他

### C. 跟进方式枚举
- 电话
- 微信
- 邮件
- 上门拜访
- 其他

### D. 销售阶段枚举
- 线索确认
- 需求分析
- 方案报价
- 谈判协商
- 合同签署
- 已成交

---

**文档版本**: v1.0
**创建日期**: 2026-01-12
**更新日期**: 2026-01-12
