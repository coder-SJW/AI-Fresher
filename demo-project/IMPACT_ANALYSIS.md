# CRM 客户管理系统 - 影响范围分析

**文档版本：** 1.0
**创建日期：** 2026-01-12
**项目名称：** CRM 客户管理系统

---

## 1. 概述

本文档分析了 CRM 客户管理系统实现过程中对现有系统、数据库、API 接口和业务流程的影响范围。

---

## 2. 新增文件清单

### 2.1 配置文件

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| `pom.xml` | Maven 项目配置 | ~150 |
| `src/main/resources/application.yml` | 应用配置文件 | ~100 |
| `src/main/resources/db/migration/V1__init_schema.sql` | 数据库初始化脚本 | ~300 |

**小计：** 3 个文件，约 550 行

---

### 2.2 公共组件代码

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| `com/crm/system/common/result/Result.java` | 统一响应封装 | ~100 |
| `com/crm/system/common/result/PageResult.java` | 分页响应封装 | ~50 |
| `com/crm/system/common/exception/BusinessException.java` | 业务异常 | ~40 |
| `com/crm/system/common/exception/GlobalExceptionHandler.java` | 全局异常处理 | ~80 |
| `com/crm/system/common/config/MyBatisPlusConfig.java` | MyBatis-Plus 配置 | ~40 |
| `com/crm/system/common/security/JwtUtil.java` | JWT 工具类 | ~120 |
| `com/crm/system/common/security/JwtAuthenticationFilter.java` | JWT 过滤器 | ~80 |
| `com/crm/system/common/constants/ErrorCode.java` | 错误码常量 | ~60 |

**小计：** 8 个文件，约 570 行

---

### 2.3 业务模块代码

#### 客户管理模块

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| `com/crm/system/modules/customer/domain/Customer.java` | 客户实体类 | ~80 |
| `com/crm/system/modules/customer/mapper/CustomerMapper.java` | 客户 Mapper | ~20 |
| `com/crm/system/modules/customer/dto/CustomerCreateRequest.java` | 创建请求 DTO | ~50 |
| `com/crm/system/modules/customer/dto/CustomerResponse.java` | 响应 DTO | ~60 |
| `com/crm/system/modules/customer/dto/CustomerQueryRequest.java` | 查询请求 DTO | ~50 |
| `com/crm/system/modules/customer/service/CustomerService.java` | 服务接口 | ~30 |
| `com/crm/system/modules/customer/service/impl/CustomerServiceImpl.java` | 服务实现 | ~200 |
| `com/crm/system/modules/customer/controller/CustomerController.java` | 控制器 | ~100 |

**小计：** 8 个文件，约 590 行

---

#### 跟进记录模块（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| FollowUp 相关文件 | 7 个文件（同客户模块结构） | ~500 |

---

#### 销售机会模块（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| Opportunity 相关文件 | 7 个文件（同客户模块结构） | ~500 |

---

#### 用户管理模块（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| User 相关文件 | 7 个文件（同客户模块结构） | ~600 |

---

#### 数据字典模块（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| Dict 相关文件 | 7 个文件（同客户模块结构） | ~400 |

---

#### 系统认证模块（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| AuthController.java | 认证控制器 | ~100 |
| AuthService.java | 认证服务 | ~150 |
| AuthServiceImpl.java | 认证服务实现 | ~200 |

**小计：** 3 个文件，约 450 行

---

### 2.4 测试代码（估算）

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| 所有模块的测试类 | 单元测试和集成测试 | ~2000 |

---

### 2.5 其他文件

| 文件路径 | 说明 | 行数估算 |
|---------|------|---------|
| `README.md` | 项目说明文档 | ~100 |
| `CrmApplication.java` | 主启动类 | ~20 |

---

## 3. 修改文件清单

### 3.1 配置文件

| 文件路径 | 修改内容 | 影响 |
|---------|---------|------|
| `pom.xml` | 添加 Spring Boot、MyBatis-Plus 等依赖 | 新项目，无修改 |
| `application.yml` | 配置数据源、JWT、MyBatis-Plus | 新项目，无修改 |

**说明：** 由于是新项目，无现有配置文件需要修改。

---

### 3.2 数据库

| 数据库 | 修改内容 | 影响 |
|--------|---------|------|
| `crm_db` | 创建新数据库，添加 6 张表 | 需要执行初始化脚本 |

**影响评估：**
- ✅ **独立数据库**：不影响现有数据库
- ✅ **完整脚本**：提供完整的初始化脚本
- ✅ **可回滚**：可以随时删除数据库

---

## 4. 数据库影响分析

### 4.1 新增表

| 表名 | 说明 | 记录数估算 |
|------|------|-----------|
| `crm_role` | 角色表 | ~10 |
| `crm_user` | 用户表 | ~100 |
| `crm_dict` | 数据字典表 | ~50 |
| `crm_customer` | 客户表 | ~10000（预期） |
| `crm_follow_up` | 跟进记录表 | ~50000（预期） |
| `crm_opportunity` | 销售机会表 | ~10000（预期） |

**小计：** 6 张表

---

### 4.2 索引影响

| 索引类型 | 数量 | 说明 |
|---------|------|------|
| 主键索引 | 6 | 每张表一个主键 |
| 唯一索引 | 2 | `crm_role.role_code`, `crm_user.username` |
| 普通索引 | ~20 | 外键字段、查询字段、时间字段 |
| 外键约束 | 4 | 表之间的关联关系 |

**性能影响：**
- ✅ **索引优化**：为常用查询字段添加索引，性能良好
- ✅ **索引数量适中**：不过度索引，不影响写入性能

---

### 4.3 数据迁移

**迁移需求：** 无

**说明：** 新系统不需要数据迁移。

---

## 5. API 接口影响分析

### 5.1 新增 API 端点

#### 认证接口（1 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| POST | `/api/v1/auth/login` | 用户登录 |

---

#### 客户管理接口（5 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| GET | `/api/v1/customers` | 分页查询客户 |
| GET | `/api/v1/customers/{id}` | 查询客户详情 |
| POST | `/api/v1/customers` | 创建客户 |
| PUT | `/api/v1/customers/{id}` | 更新客户 |
| DELETE | `/api/v1/customers/{id}` | 删除客户 |

---

#### 跟进记录接口（5 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| GET | `/api/v1/follow-ups` | 查询跟进记录 |
| GET | `/api/v1/follow-ups/reminders` | 查询跟进提醒 |
| POST | `/api/v1/follow-ups` | 创建跟进记录 |
| PUT | `/api/v1/follow-ups/{id}` | 更新跟进记录 |
| DELETE | `/api/v1/follow-ups/{id}` | 删除跟进记录 |

---

#### 销售机会接口（6 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| GET | `/api/v1/opportunities` | 查询销售机会 |
| GET | `/api/v1/opportunities/funnel` | 销售漏斗统计 |
| POST | `/api/v1/opportunities` | 创建销售机会 |
| PUT | `/api/v1/opportunities/{id}` | 更新销售机会 |
| PUT | `/api/v1/opportunities/{id}/advance-stage` | 推进销售阶段 |
| DELETE | `/api/v1/opportunities/{id}` | 删除销售机会 |

---

#### 用户管理接口（5 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| GET | `/api/v1/users` | 查询用户列表 |
| POST | `/api/v1/users` | 创建用户 |
| PUT | `/api/v1/users/{id}` | 更新用户 |
| POST | `/api/v1/users/{id}/reset-password` | 重置密码 |
| DELETE | `/api/v1/users/{id}` | 删除用户 |

---

#### 数据字典接口（3 个）

| HTTP 方法 | URL | 说明 |
|-----------|-----|------|
| GET | `/api/v1/dict/{dictType}` | 查询字典列表 |
| POST | `/api/v1/dict` | 创建字典 |
| PUT | `/api/v1/dict/{id}` | 更新字典 |

**小计：** 25 个 API 端点

---

### 5.2 API 版本管理

**版本策略：** URL 版本（`/api/v1/`）

**向后兼容性：**
- ✅ 新系统，无需考虑兼容性
- ✅ 未来版本可使用 `/api/v2/` 实现升级

---

## 6. 系统集成影响分析

### 6.1 对现有系统的影响

**影响等级：** ✅ **无影响**

**说明：**
- 新系统独立部署
- 独立数据库
- 不依赖现有系统

---

### 6.2 第三方集成

**当前集成：** 无

**未来可能集成：**
- 邮件服务（发送通知）
- 短信服务（发送验证码）
- 微信服务（消息推送）
- BI 工具（数据分析）

---

## 7. 部署影响分析

### 7.1 环境要求

| 组件 | 版本要求 | 用途 |
|------|---------|------|
| JDK | 1.8+ | 运行环境 |
| Maven | 3.6+ | 构建工具 |
| MySQL | 8.0+ | 数据库 |
| Redis | 6.x（可选） | 缓存 |

---

### 7.2 资源需求

| 资源 | 最低配置 | 推荐配置 |
|------|---------|---------|
| CPU | 2 核 | 4 核 |
| 内存 | 2GB | 4GB |
| 磁盘 | 10GB | 50GB |
| 网络 | 1Mbps | 10Mbps |

---

### 7.3 部署方式

**推荐方式：** Docker 容器化部署

**Dockerfile 示例：**
```dockerfile
FROM openjdk:8-jdk-alpine
VOLUME /tmp
COPY target/crm-system-1.0.0.jar app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

---

## 8. 性能影响分析

### 8.1 性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| API 响应时间 | < 500ms (P95) | 大部分接口 |
| 并发用户 | 100+ | 同时在线用户 |
| QPS | 500+ | 每秒请求数 |
| 数据库连接 | 50 | 连接池大小 |

---

### 8.2 优化措施

1. **数据库优化**
   - 合理的索引设计
   - 分页查询避免深度分页
   - 使用查询缓存

2. **应用层优化**
   - 异步处理非关键操作
   - 使用 Redis 缓存热点数据
   - 批量操作代替循环单条操作

3. **架构优化**
   - 应用服务器集群部署
   - 数据库读写分离（未来）
   - CDN 加速（前端资源）

---

## 9. 安全影响分析

### 9.1 安全措施

| 安全措施 | 实现方式 | 状态 |
|---------|---------|------|
| 身份认证 | JWT Token | ✅ 已设计 |
| 权限控制 | RBAC | ✅ 已设计 |
| 密码加密 | BCrypt | ✅ 已设计 |
| SQL 注入防护 | 预编译语句 | ✅ 已设计 |
| XSS 防护 | 输入校验 | ✅ 已设计 |
| HTTPS | TLS 证书 | ⚠️ 需配置 |

---

### 9.2 安全注意事项

1. **生产环境必须修改：**
   - JWT 密钥（`jwt.secret`）
   - 数据库密码（`spring.datasource.password`）
   - 管理员密码（默认：123456）

2. **建议启用：**
   - HTTPS 加密传输
   - 请求限流（防止暴力攻击）
   - 安全审计日志

---

## 10. 兼容性影响分析

### 10.1 浏览器兼容性

**支持的浏览器：**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**说明：** 后端 API 无浏览器限制，前端需要考虑兼容性。

---

### 10.2 移动端兼容性

**支持方式：** RESTful API

**说明：** 后端 API 可以被移动端应用调用。

---

## 11. 风险评估

### 11.1 技术风险

| 风险 | 等级 | 缓解措施 |
|------|------|---------|
| 性能瓶颈 | 中 | 索引优化、缓存、分页 |
| 并发冲突 | 中 | 乐观锁、事务管理 |
| 数据泄露 | 高 | 密码加密、HTTPS、权限控制 |

---

### 11.2 业务风险

| 风险 | 等级 | 缓解措施 |
|------|------|---------|
| 数据丢失 | 高 | 每日备份、容灾方案 |
| 误操作 | 中 | 软删除、操作日志 |
| 权限滥用 | 中 | RBAC、审计日志 |

---

## 12. 部署检查清单

### 12.1 部署前检查

- [ ] 所有新文件已添加到版本控制
- [ ] 数据库初始化脚本已测试
- [ ] 所有测试用例通过（单元测试 + 集成测试）
- [ ] 代码审查已完成
- [ ] API 文档已生成（Swagger）
- [ ] 性能测试已通过（并发 100 用户）
- [ ] 安全审查已完成

---

### 12.2 部署步骤

1. **环境准备**
   - [ ] 安装 JDK 1.8+
   - [ ] 安装 MySQL 8.0+
   - [ ] 安装 Redis 6.x（可选）

2. **数据库初始化**
   - [ ] 创建数据库 `crm_db`
   - [ ] 执行初始化脚本 `V1__init_schema.sql`
   - [ ] 验证表和数据是否正确

3. **应用部署**
   - [ ] 修改配置文件（数据库连接、JWT 密钥）
   - [ ] Maven 打包：`mvn clean package`
   - [ ] 启动应用：`java -jar crm-system-1.0.0.jar`
   - [ ] 验证健康检查：`http://localhost:8080/api/actuator/health`

4. **功能验证**
   - [ ] 测试登录接口
   - [ ] 测试客户 CRUD 接口
   - [ ] 测试其他核心接口
   - [ ] 验证权限控制

---

### 12.3 回滚方案

**触发条件：**
- 部署后出现严重 Bug
- 性能严重下降
- 数据异常

**回滚步骤：**
1. 停止新版本应用
2. 恢复数据库备份（如需要）
3. 启动旧版本应用
4. 验证功能正常

---

## 13. 监控和告警

### 13.1 监控指标

| 指标 | 告警阈值 | 说明 |
|------|---------|------|
| API 响应时间 P95 | > 1s | 性能下降 |
| API 错误率 | > 1% | 系统异常 |
| 数据库连接池使用率 | > 80% | 连接池耗尽 |
| JVM 内存使用率 | > 85% | 内存泄漏 |

---

### 13.2 日志管理

**日志级别：**
- ERROR：错误日志（永久保留）
- WARN：警告日志（保留 30 天）
- INFO：操作日志（保留 7 天）
- DEBUG：调试日志（保留 1 天）

**日志位置：** `logs/crm-system.log`

---

## 14. 总结

### 14.1 影响总结

| 维度 | 影响等级 | 说明 |
|------|---------|------|
| 数据库 | ✅ 低 | 新建独立数据库，无影响 |
| API 接口 | ✅ 低 | 新增 25 个接口，不影响现有接口 |
| 系统集成 | ✅ 无 | 独立部署，无依赖 |
| 性能 | ✅ 低 | 有优化措施，性能可控 |
| 安全 | ⚠️ 中 | 需注意配置和密码安全 |

---

### 14.2 关键成功因素

1. **严格执行代码规范**
2. **充分的测试覆盖**
3. **完善的监控和告警**
4. **及时的安全加固**

---

### 14.3 后续优化建议

1. **性能优化**
   - 引入 Redis 缓存
   - 数据库读写分离
   - API 响应缓存

2. **功能增强**
   - 消息推送（邮件、短信）
   - 数据导出（Excel、PDF）
   - 报表统计分析

3. **架构升级**
   - 微服务拆分（如需要）
   - 容器化部署（Docker + K8s）
   - CI/CD 自动化

---

**影响范围分析文档结束**

---

## 附录：文件统计总览

### 代码量统计

| 类型 | 文件数 | 代码行数（估算） |
|------|--------|----------------|
| 配置文件 | 3 | 550 |
| 公共组件 | 8 | 570 |
| 客户管理模块 | 8 | 590 |
| 跟进记录模块 | 7 | 500 |
| 销售机会模块 | 7 | 500 |
| 用户管理模块 | 7 | 600 |
| 数据字典模块 | 7 | 400 |
| 认证模块 | 3 | 450 |
| 测试代码 | ~20 | 2000 |
| 文档 | 3 | 500 |
| **总计** | **~75** | **~6,660** |

---

**开发团队参考：**

本影响范围分析文档旨在帮助开发团队全面了解 CRM 系统实现过程中的各种影响。请严格按照本文档的检查清单和步骤进行部署，确保系统安全、稳定地运行。
